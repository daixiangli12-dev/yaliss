<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç½‘ç›˜èµ„æºæœç´¢</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f7fa;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    .search-box {
      display: flex;
      max-width: 600px;
      margin: 0 auto 20px;
    }
    input[type="text"] {
      flex: 1;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px 0 0 4px;
      font-size: 16px;
    }
    button {
      padding: 12px 20px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #2980b9;
    }

    .results {
      max-width: 600px;
      margin: 0 auto;
    }
    .item {
      background: white;
      padding: 16px;
      margin-bottom: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
.link {
  text-decoration: underline;
  display: inline-block;
  margin-top: 4px;
  font-weight: 500;
  transition: color 0.2s ease;
}

.main-link, .backup-link { color: #3498db; }   /* ç»Ÿä¸€è“è‰² */
.pwd-link { color: #e67e22; }                 /* æ©™è‰²çªå‡ºæå–ç  */

.link:hover {
  text-decoration: none;
  color: #1a5f9d;
}

    /* å¼¹çª—é®ç½© */
    #auth-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 350px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    input[type="password"] {
      width: 100%;
      padding: 10px;
      margin: 12px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .quark-link {
      display: block;
      margin-top: 15px;
      color: #e74c3c;
      text-decoration: underline;
      font-size: 14px;
    }
    .error {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 8px;
      min-height: 18px;
    }
  </style>
</head>
<body>

  <h1>ç½‘ç›˜èµ„æºæœç´¢</h1>
  <div class="search-box">
    <input type="text" id="keyword" placeholder="è¾“å…¥èµ„æºåç§°..." autocomplete="off" />
    <button onclick="search()">æœç´¢</button>
  </div>
  <div id="results" class="results"></div>

  <!-- è®¿é—®ç éªŒè¯å¼¹çª— -->
  <div id="auth-modal">
    <div class="modal-content">
      <h3>è¯·è¾“å…¥è®¿é—®ç </h3>
      <p>è¯·å…ˆè½¬å­˜ä¸‹æ–¹ç½‘ç›˜è·å–è®¿é—®ç ï¼š</p>
      <a href="https://pan.quark.cn/s/87ab9a737028" target="_blank" class="quark-link">ğŸ‘‰ å¤¸å…‹ç½‘ç›˜ï¼ˆç‚¹æ­¤è½¬å­˜ï¼‰</a>
      <input type="password" id="accessCode" placeholder="è®¿é—®ç " />
      <button onclick="checkAccessCode()">ç¡®å®š</button>
      <div id="auth-error" class="error"></div>
    </div>
  </div>

  <script>
// å…¨å±€å­˜å‚¨ä»Šæ—¥é…ç½®
let DAILY_CONFIG = null;

// é¡µé¢åŠ è½½æ—¶è·å–ä»Šæ—¥è®¿é—®ç å’Œå¤¸å…‹é“¾æ¥
async function loadDailyConfig() {
  try {
    const res = await fetch('https://yali-search-api.daixiangli12.workers.dev/api/today-code');
    if (!res.ok) throw new Error('è·å–é…ç½®å¤±è´¥');
    DAILY_CONFIG = await res.json();

    // æ›´æ–°å¼¹çª—ä¸­çš„å¤¸å…‹é“¾æ¥
    document.querySelector('.quark-link').href = DAILY_CONFIG.quark_link;
  } catch (err) {
    console.error('åŠ è½½ä»Šæ—¥é…ç½®å¤±è´¥:', err);
    document.getElementById('auth-error').textContent = 'åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢';
  }
}

// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ
loadDailyConfig();
    // === åˆå§‹åŒ–ï¼šæ£€æŸ¥æ˜¯å¦å·²æˆæƒ ===
    if (localStorage.getItem('yali_authorized') === 'true') {
      document.getElementById('auth-modal').style.display = 'none';
    }

    // === å›è½¦æœç´¢ ===
    document.getElementById('keyword').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        search();
      }
    });

    // === æœç´¢å‡½æ•° ===
    async function search() {
if (localStorage.getItem('yali_authorized') !== 'true' || !DAILY_CONFIG) {
  alert('è¯·å…ˆè¾“å…¥è®¿é—®ç ï¼');
  return;
}

      const keyword = document.getElementById('keyword').value.trim();
      if (!keyword) {
        document.getElementById('results').innerHTML = '<p>è¯·è¾“å…¥å…³é”®è¯</p>';
        return;
      }

      try {
        const url = `https://yali-search-api.daixiangli12.workers.dev/api/search?name=${encodeURIComponent(keyword)}&secret=xK9mP2qR`;
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error(await res.text());
        }
        const data = await res.json();
        const resultsEl = document.getElementById('results');
        resultsEl.innerHTML = '';

        if (data.length === 0) {
          resultsEl.innerHTML = '<p>æœªæ‰¾åˆ°ç›¸å…³èµ„æº</p>';
          return;
        }

        data.forEach(item => {
  const div = document.createElement('div');
  div.className = 'item';

  // === 1. åŠ¨æ€ç”Ÿæˆ main_linkï¼šä» baidu_link, yd_link, xl_link éšæœºé€‰ ===
  const mainCandidates = [];
  if (item.baidu_link && item.baidu_link.trim()) mainCandidates.push(item.baidu_link);
  if (item.yd_link && item.yd_link.trim()) mainCandidates.push(item.yd_link);
  if (item.xl_link && item.xl_link.trim()) mainCandidates.push(item.xl_link);

  let mainLink = '';
  if (mainCandidates.length > 0) {
    mainLink = mainCandidates[Math.floor(Math.random() * mainCandidates.length)];
  }

  // === 2. åŠ¨æ€ç”Ÿæˆ backup_passwordï¼šä» wkm_link, quarkm_link, ktm_link éšæœºé€‰ ===
  const pwdCandidates = [];
  if (item.wkm_link && item.wkm_link.trim()) pwdCandidates.push(item.wkm_link);
  if (item.quarkm_link && item.quarkm_link.trim()) pwdCandidates.push(item.quarkm_link);
  if (item.ktm_link && item.ktm_link.trim()) pwdCandidates.push(item.ktm_link);

  let backupPasswordLink = '';
  if (pwdCandidates.length > 0) {
    backupPasswordLink = pwdCandidates[Math.floor(Math.random() * pwdCandidates.length)];
  }

  // === 3. æ„å»º HTML ===
  let html = `<strong>${item.name}</strong><br/>`;

  if (mainLink) {
    html += `<div><a href="${mainLink}" target="_blank" class="link main-link">ğŸ”— ä¸»é“¾æ¥</a></div>`;
  }
  if (item.backup_link && item.backup_link.trim()) {
    html += `<div><a href="${item.backup_link}" target="_blank" class="link backup-link">ğŸ”— å¤‡ç”¨é“¾æ¥</a></div>`;
  }
  if (backupPasswordLink) {
    html += `<div><a href="${backupPasswordLink}" target="_blank" class="link pwd-link">ğŸ”‘ æå–ç </a></div>`;
  }

  if (!mainLink && !item.backup_link?.trim() && !backupPasswordLink) {
    html += '<div>âŒ æ— æœ‰æ•ˆé“¾æ¥</div>';
  }

  div.innerHTML = html;
  resultsEl.appendChild(div);
});
      } catch (err) {
        console.error(err);
        document.getElementById('results').innerHTML = `<p style="color:red;">æœç´¢å¤±è´¥ï¼š${err.message}</p>`;
      }
    }

    // === éªŒè¯è®¿é—®ç  ===
function checkAccessCode() {
  const errorEl = document.getElementById('auth-error');
  errorEl.textContent = ''; // æ¸…ç©ºæ—§é”™è¯¯

  if (!DAILY_CONFIG) {
    errorEl.textContent = 'é…ç½®åŠ è½½ä¸­ï¼Œè¯·ç¨åå†è¯•';
    return;
  }

  const code = document.getElementById('accessCode').value.trim();
  if (code === DAILY_CONFIG.code) {
    localStorage.setItem('yali_authorized', 'true');
    document.getElementById('auth-modal').style.display = 'none';
  } else {
    errorEl.textContent = 'è®¿é—®ç é”™è¯¯ï¼Œè¯·é‡è¯•';
  }
}
  </script>
</body>
</html>